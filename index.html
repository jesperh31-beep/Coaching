<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FloorCoach ‚Äì tr√¶ningsplanner (offline)</title>
  <style>
    :root { --blue: #2563eb; --blue-light: #dbeafe; --blue-dark: #1d4ed8; --green: #16a34a; --green-light: #dcfce7; --orange: #ea580c; --orange-light: #ffedd5; --gray: #6b7280; --bg: #f3f4f6; --border: #e5e7eb; --red: #dc2626; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: var(--bg); color: #0f172a; }
    a { color: var(--blue-dark); }
    .app-shell { display: flex; min-height: 100vh; }
    .sidebar { width: 240px; background: #ffffff; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
    .sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
    .logo-box { width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, var(--blue-dark), #0ea5e9); display: flex; align-items: center; justify-content: center; font-size: 22px; color: #fff; font-weight: 700; }
    .sidebar-nav { padding: 8px; flex: 1; overflow-y: auto; }
    .nav-button { width: 100%; border: none; background: transparent; text-align: left; padding: 10px 12px; margin-bottom: 4px; border-radius: 999px; display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 14px; color: #111827; }
    .nav-button span.icon { width: 20px; text-align: center; opacity: 0.8; }
    .nav-button.active { background: var(--blue-light); color: var(--blue-dark); font-weight: 600; }
    .nav-button:hover:not(.active) { background: #f3f4ff; }
    .sidebar-footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
    .avatar { width: 34px; height: 34px; border-radius: 999px; background: linear-gradient(135deg, #e5e7eb, #9ca3af); display: flex; align-items: center; justify-content: center; font-weight: 600; color: #374151; font-size: 14px; }
    .avatar-info { font-size: 12px; }
    .avatar-info div:first-child { font-weight: 600; }
    .avatar-info div:last-child { color: #6b7280; }
    .main { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    .main-header { display: none; padding: 10px 14px; border-bottom: 1px solid var(--border); background: #ffffff; align-items: center; gap: 10px; }
    .hamburger { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border); background: #f9fafb; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    .hamburger-lines { width: 16px; height: 12px; display: flex; flex-direction: column; justify-content: space-between; }
    .hamburger-lines span { height: 2px; background: #111827; border-radius: 999px; }
    .main-title { font-size: 18px; font-weight: 700; }
    .main-content { padding: 16px; overflow-y: auto; }
    .page-header { margin-bottom: 16px; }
    .page-title { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .page-subtitle { font-size: 14px; color: var(--gray); }
    .grid { display: grid; gap: 16px; }
    @media (min-width: 900px) { .grid-2 { grid-template-columns: 2fr 1.5fr; } .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } .grid-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
    .card { background: #ffffff; border-radius: 12px; border: 1px solid var(--border); padding: 14px; }
    .card-header { margin-bottom: 10px; display: flex; align-items: center; gap: 8px; font-weight: 600; }
    .chip { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; border: 1px solid var(--border); padding: 2px 8px; font-size: 11px; background: #f9fafb; color: #111827; border: 1px solid #e5e7eb; }
    .chip-blue { background: var(--blue-light); border-color: var(--blue-dark); color: var(--blue-dark); font-weight: 600; }
    .chip-green { background: var(--green-light); border-color: var(--green); color: var(--green); font-weight: 600; }
    .chip-orange { background: var(--orange-light); border-color: var(--orange); color: var(--orange); font-weight: 600; }
    .chip-gray { background: #e5e7eb; border-color: #9ca3af; color: #374151; }
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; border-radius: 999px; border: 1px solid var(--border); padding: 6px 12px; font-size: 13px; cursor: pointer; background: #ffffff; color: #111827; }
    .btn-primary { background: var(--blue); border-color: var(--blue-dark); color: #ffffff; }
    .btn-primary:hover { background: var(--blue-dark); }
    .btn-success { background: var(--green); border-color: var(--green); color: #ffffff; }
    .btn-success:hover { background: #15803d; }
    .btn-danger { background: #fee2e2; border-color: #fecaca; color: var(--red); }
    .btn-danger:hover { background: #fecaca; }
    .btn-ghost { background: transparent; border-color: transparent; color: var(--gray); }
    .btn-ghost:hover { background: #f3f4f6; }
    .btn-sm { padding: 4px 8px; font-size: 12px; }
    .input, .select, .textarea { width: 100%; border-radius: 8px; border: 1px solid var(--border); padding: 6px 8px; font-size: 13px; font-family: inherit; }
    .textarea { min-height: 60px; resize: vertical; }
    .label { font-size: 12px; font-weight: 600; margin-bottom: 4px; display: block; }
    .badge { display: inline-flex; align-items: center; border-radius: 999px; padding: 2px 8px; font-size: 11px; background: #f3f4f6; color: #111827; border: 1px solid #e5e7eb; }
    .table { width: 100%; border-collapse: collapse; font-size: 13px; }
    .table th, .table td { padding: 6px 8px; border-bottom: 1px solid var(--border); text-align: left; vertical-align: top; }
    .table th { background: #f9fafb; font-weight: 600; font-size: 12px; }
    .flex { display: flex; gap: 8px; }
    .flex-between { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
    .flex-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
    .mt-1 { margin-top: 4px; } .mt-2 { margin-top: 8px; } .mt-3 { margin-top: 12px; } .mt-4 { margin-top: 16px; }
    .text-sm { font-size: 13px; } .text-xs { font-size: 11px; } .text-muted { color: var(--gray); }
    .w-50 { width: 50%; } .w-33 { width: 33%; } .w-25 { width: 25%; }
    .tag-list { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
    .tag-pill { font-size: 11px; padding: 2px 6px; border-radius: 999px; background: #e5e7eb; color: #111827; }
    .mobile-sidebar { display: none; }
    @media (max-width: 800px) { .sidebar { display: none; } .main-header { display: flex; } .app-shell { flex-direction: column; } .mobile-sidebar { display: block; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.5); z-index: 20; } .mobile-sidebar-inner { width: 260px; max-width: 80%; height: 100%; background: #ffffff; box-shadow: 4px 0 20px rgba(15, 23, 42, 0.2); display: flex; flex-direction: column; } .main-content { padding: 12px; } }
    /* Modal styles */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 60; }
    .modal.show { display: flex; }
    .modal .card { max-width: 900px; width: 95%; max-height: 90%; overflow: auto; padding: 12px; border-radius: 8px; background: white; }
    .plan-move-btn { padding:4px 6px; font-size:12px; margin-left:6px; }
  </style>
</head>
<body>
<div id="app">
  <div class="app-shell">
    <nav class="sidebar" id="sidebar-desktop">
      <div class="sidebar-header">
        <div class="logo-box">üèë</div>
        <div>
          <div style="font-weight:700;font-size:15px;">FloorCoach</div>
          <div style="font-size:11px;color:var(--gray);">Tr√¶ningsplanner (offline)</div>
        </div>
      </div>
      <div class="sidebar-nav" id="nav-buttons"></div>
      <div class="sidebar-footer">
        <div class="avatar">T</div>
        <div class="avatar-info">
          <div>Tr√¶ner</div>
          <div>U17, U19, H1</div>
        </div>
      </div>
    </nav>

    <main class="main">
      <header class="main-header">
        <div class="hamburger" id="hamburger-button">
          <div class="hamburger-lines"><span></span><span></span><span></span></div>
        </div>
        <div class="main-title">FloorCoach</div>
      </header>
      <div class="main-content">
        <div id="page-dashboard" class="page"></div>
        <div id="page-exercises" class="page" style="display:none;"></div>
        <div id="page-plan" class="page" style="display:none;"></div>
        <div id="page-match" class="page" style="display:none;"></div>
        <div id="page-active" class="page" style="display:none;"></div>
        <div id="page-history" class="page" style="display:none;"></div>
        <div id="page-settings" class="page" style="display:none;"></div>
      </div>
    </main>
  </div>

  <div class="mobile-sidebar" id="mobile-sidebar" style="display:none;">
    <div class="mobile-sidebar-inner">
      <div class="sidebar-header">
        <div class="logo-box">üèë</div>
        <div>
          <div style="font-weight:700;font-size:15px;">FloorCoach</div>
          <div style="font-size:11px;color:var(--gray);">Tr√¶ningsplanner</div>
        </div>
      </div>
      <div class="sidebar-nav" id="nav-buttons-mobile"></div>
      <div class="sidebar-footer">
        <div class="avatar">T</div>
        <div class="avatar-info"><div>Tr√¶ner</div><div>U17, U19, H1</div></div>
      </div>
    </div>
  </div>
</div>

<!-- Image modal (click to enlarge) -->
<div class="modal" id="imageModal"><div class="card"><button id="closeImageModal" class="btn btn-ghost" style="float:right;">Luk</button><div id="imageModalContent" style="text-align:center;"></div></div></div>

<script>
  // Keep original data key
  const STORAGE_KEY = "floorcoach-data-v1";
  function loadData(){ try{ const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return getDefaultData(); const parsed = JSON.parse(raw); return { exercises: parsed.exercises || [], teams: parsed.teams || [], sessions: parsed.sessions || [], matches: parsed.matches || [] }; }catch(e){ console.error(e); return getDefaultData(); } }
  function saveData(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }catch(e){console.error(e);} }
  function getDefaultData(){ /* same default as original to keep example */ const exercises = [ { id: "ex-101", number: "101", title: "Rondo 4v2", purpose: "Forbedre pasningsspil og beslutningstagning under pres.", categories: ["teknik","sm√•spil"], level: "alle", duration_min: 10, min_players: 6, materials:["Kegler"], description: "Spillerne st√•r i en cirkel med to pressere i midten. Bolden spilles rundt.", steps:["Ops√¶t en cirkel med 4 spillere udenfor og 2 i midten.","Bolden holdes i gang med maksimalt to ber√∏ringer.","De to i midten fors√∏ger at erobre bolden."], tags:["pasninger","sm√•spil"], media_url: "", goalkeepers_required: 0, requires_groups: true, min_groups: 2 }, { id: "ex-201", number: "201", title: "Afslutninger fra halvbanen", purpose: "Tr√¶ne afslutninger efter gennembrud.", categories:["teknik","skud"], level:"U17", duration_min:12, min_players:4, materials:["Sm√• m√•l","K√¶detr√∏jer"], description: "Spillere l√∏ber i baner og afslutter efter skudfinte.", steps:["Spiller starter i hj√∏rnet og modtager bold.","En finte og afslutning p√• m√•l.","Roter mellem siderne."], tags:["skud","afslutninger"], media_url:"", goalkeepers_required:1, requires_groups:false, min_groups:null } ]; const teams = [ { id: "team-u17", name: "U17", squad_players: ["Anders","Mads","Jonas","Emil","Oliver","Frederik"] }, { id: "team-u19", name: "U19", squad_players: ["Kasper","Malthe","Lasse","Magnus"] }, { id: "team-h1", name: "H1", squad_players: ["Nikolaj","Martin","Peter","Thomas"] } ]; const sessions = [ { id: "ses-1", team_name: "U17", date: new Date().toISOString(), goal: "Spil i sm√• rum og hurtige beslutninger", participating_players: ["Anders","Mads","Jonas","Emil"], items: [ { exercise_number: "101", exercise_title: "Rondo 4v2", planned_duration_min: 12, notes: "Fokus p√• max 2 ber√∏ringer.", rating: null, exercise_players: ["Anders","Mads","Jonas"] }, { exercise_number: "201", exercise_title: "Afslutninger fra halvbanen", planned_duration_min: 15, notes: "", rating: null, exercise_players: [] } ], default_groups: [], notes: "Hold kort pause mellem √∏velserne.", status: "planned", total_duration_min: 27, is_template: false } ]; const matches = []; return { exercises, teams, sessions, matches }; }
  let data = loadData();
  const pages = [ {id:"dashboard",label:"Forside",icon:"üè†"},{id:"exercises",label:"√òvelser",icon:"üìò"},{id:"plan",label:"Planl√¶g",icon:"üóìÔ∏è"},{id:"match",label:"Kamp",icon:"üèüÔ∏è"},{id:"active",label:"K√∏replan",icon:"‚è±Ô∏è"},{id:"history",label:"Historik",icon:"üìä"},{id:"settings",label:"Indstillinger",icon:"‚öôÔ∏è"} ];
  let currentPage = "dashboard";

  // Plan state
  let planState = { team_name: data.teams[0]?.name || "U17", date: new Date().toISOString().slice(0,10), goal: "", exerciseSelections: [], notes:"", participating_players: [], extra_players_text: "" };

  // Match default chains
  const defaultChains = ["1. k√¶de","2. k√¶de","3. k√¶de","Reserver","startende m√•lmand","PowerPlay","BoxPlay"];
  let matchPlanState = { team_name: data.teams[0]?.name || "U17", date: new Date().toISOString().slice(0,16), opponent: "", players: [], extra_players_text: "", notes_opponent: "", notes_prev: "", notes_focus: "", tactics_def: "", tactics_att: "", lines: defaultChains.map(n=>({name:n, players:[]})) };

  function renderNav(){ const desktop=document.getElementById("nav-buttons"); const mobile=document.getElementById("nav-buttons-mobile"); desktop.innerHTML=''; mobile.innerHTML=''; function makeButton(page){ const btn=document.createElement('button'); btn.className='nav-button'+(currentPage===page.id?' active':''); btn.onclick=()=>{ currentPage=page.id; render(); const ms=document.getElementById('mobile-sidebar'); if(ms.style.display==='block') ms.style.display='none'; }; btn.innerHTML=`<span class="icon">${page.icon}</span><span>${page.label}</span>`; return btn;} pages.forEach(p=>{ desktop.appendChild(makeButton(p)); mobile.appendChild(makeButton(p)); }); }
  function fmtDate(dateStr){ if(!dateStr) return ''; const d=new Date(dateStr); if(isNaN(d)) return ''; return d.toLocaleDateString('da-DK',{ weekday:'short', day:'numeric', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' }); }

  function findExerciseByNumber(num){ return data.exercises.find(e=>e.number===num); }

  // Render Dashboard (unchanged)
  function renderDashboard(){ const el=document.getElementById('page-dashboard'); const sessionsSorted=[...data.sessions].sort((a,b)=>new Date(a.date)-new Date(b.date)); const upcoming=sessionsSorted.filter(s=>new Date(s.date)>=new Date() && s.status!=='done'); const inProgress=sessionsSorted.filter(s=>s.status==='in_progress'); const doneCount=data.sessions.filter(s=>s.status==='done').length; el.innerHTML=`<div class="page-header"><div class="page-title">Velkommen tilbage</div><div class="page-subtitle">Overblik over dine tr√¶ninger</div></div><div class="grid grid-2"><div class="card"><div class="card-header"><span>Aktiv status</span></div>${ inProgress.length>0?`<div class="chip chip-orange">Tr√¶ning i gang</div><div class="mt-2 text-sm">${inProgress[0].team_name} ‚Ä¢ ${inProgress[0].goal||'Ingen m√•l angivet'}</div><div class="mt-2"><button class="btn btn-primary" onclick="goToPage('active')">G√• til k√∏replan</button></div>`:`<div class="text-sm text-muted">Ingen tr√¶ning er i gang lige nu.</div><div class="mt-2"><button class="btn btn-primary" onclick="goToPage('plan')">Planl√¶g ny tr√¶ning</button></div>` }</div><div class="card"><div class="card-header"><span>N√∏gletal</span></div><div class="grid grid-3"><div><div class="text-xs text-muted">√òvelser i kataloget</div><div style="font-size:22px;font-weight:700;">${data.exercises.length}</div></div><div><div class="text-xs text-muted">Gennemf√∏rte tr√¶ninger</div><div style="font-size:22px;font-weight:700;">${doneCount}</div></div><div><div class="text-xs text-muted">Planlagte tr√¶ninger</div><div style="font-size:22px;font-weight:700;">${upcoming.length}</div></div></div></div></div><div class="card mt-4"><div class="card-header"><span>Kommende tr√¶ninger</span></div>${ upcoming.length===0?`<div class="text-sm text-muted">Ingen planlagte tr√¶ninger.</div>`:`<table class="table"><thead><tr><th>Dato</th><th>Hold</th><th>M√•l</th><th>Varighed</th><th></th></tr></thead><tbody>${upcoming.map(s=>`<tr><td>${fmtDate(s.date)}</td><td>${s.team_name}</td><td>${s.goal||''}</td><td>${s.total_duration_min||0} min</td><td><button class="btn btn-primary btn-sm" onclick="openSessionInActive('${s.id}')">K√∏r</button></td></tr>`).join('')}</tbody></table>` }</div>`; }

  // Exercises (unchanged except making images clickable)
  function renderExercises(){ const el=document.getElementById('page-exercises'); const exercises=data.exercises; el.innerHTML=`<div class="page-header"><div class="page-title">√òvelseskatalog</div><div class="page-subtitle">Administrer og gennemse alle √∏velser</div></div><div class="card"><div class="flex-between"><div class="w-50"><label class="label" for="ex-search">S√∏g efter nummer eller titel</label><input id="ex-search" class="input" placeholder="Fx 101 eller Rondo" /></div><div class="w-25"><label class="label" for="ex-level">Niveau</label><select id="ex-level" class="select"><option value="">Alle</option><option value="U17">U17</option><option value="U19">U19</option><option value="H1">H1</option><option value="alle">Alle</option></select></div><div class="w-25" style="text-align:right;"><button class="btn btn-primary" onclick="showExerciseForm()">Ny √∏velse</button></div></div><div class="mt-2"><label class="label" for="ex-category">Kategori</label><select id="ex-category" class="select"><option value="">Alle</option><option value="teknik">Teknik</option><option value="taktik">Taktik</option><option value="fysisk">Fysisk</option><option value="m√•lmand">M√•lmand</option><option value="opspil">Opspil</option><option value="sm√•spil">Sm√•spil</option><option value="fuldbane">Fuldbane</option><option value="med backer">Med backer</option><option value="kamprelateret">Kamprelateret</option><option value="andet">Andet</option></select></div></div><div class="card mt-3" id="ex-list-container"></div><div class="card mt-3" id="ex-form-container" style="display:none;"></div>`;
    function redrawList(){ const search=document.getElementById('ex-search').value.toLowerCase(); const level=document.getElementById('ex-level').value; const category=document.getElementById('ex-category').value; const filtered = exercises.filter(e=>{ const txt=(e.number+' '+e.title).toLowerCase(); if(search && !txt.includes(search)) return false; if(level && e.level!==level) return false; if(category && !(e.categories||[]).includes(category)) return false; return true; }); const container=document.getElementById('ex-list-container'); if(filtered.length===0){ container.innerHTML=`<div class="text-sm text-muted">Ingen √∏velser matcher dine filtre.</div>`; return; } container.innerHTML=`<table class="table"><thead><tr><th>#</th><th>Titel</th><th>Kategorier</th><th>Niveau</th><th>Varighed</th><th>Billede</th><th>M√•lm.</th><th>Grupper</th><th></th></tr></thead><tbody>${filtered.map(e=>`<tr><td>${e.number}</td><td>${e.title}</td><td><div class="tag-list">${(e.categories||[]).map(c=>`<span class="tag-pill">${c}</span>`).join('')}</div></td><td>${e.level}</td><td>${e.duration_min||0} min</td><td>${ e.media_url?`<span class="badge">Har billede</span>`:`<span class="text-xs text-muted">Ingen</span>`}</td><td>${ typeof e.goalkeepers_required==='number'?e.goalkeepers_required:'-'}</td><td>${ e.requires_groups? 'Ja'+(e.min_groups? ' (min. '+e.min_groups+')':'') : 'Nej' }</td><td><button class="btn btn-ghost btn-sm" onclick="editExercise('${e.id}')">Rediger</button><button class="btn btn-danger btn-sm" onclick="deleteExercise('${e.id}')">Slet</button></td></tr>`).join('')}</tbody></table>`; }
    document.getElementById('ex-search').oninput=redrawList; document.getElementById('ex-level').onchange=redrawList; document.getElementById('ex-category').onchange=redrawList; redrawList(); }

  // Exercise form and save logic remains the same (omitted in this query for brevity) - will be kept identical to original file content

  // Plan rendering: add free exercise input and move up/down
  function renderPlan(){ const el=document.getElementById('page-plan'); const teams=data.teams; if(!teams.find(t=>t.name===planState.team_name) && teams.length>0){ planState.team_name=teams[0].name; planState.participating_players=[]; } const team=teams.find(t=>t.name===planState.team_name)||teams[0]||null; const teamPlayers=team?team.squad_players:[]; const _teamPlayers=teamPlayers; const totalDuration = planState.exerciseSelections.reduce((sum,item)=>{ const ex=findExerciseByNumber(item.exercise_number); return sum + (item.planned_duration_min||ex?.duration_min||0); },0); const teamOptions=teams.map(t=>`<option value="${t.name}">${t.name}</option>`).join(''); el.innerHTML=`<div class="page-header"><div class="page-title">Planl√¶g tr√¶ning</div><div class="page-subtitle">Opret en ny tr√¶ningsplan</div></div><div class="grid grid-2"><div class="card"><div class="card-header">Tr√¶ningsinfo</div><label class="label mt-1">Hold</label><select id="pl-team" class="select">${teamOptions}</select><label class="label mt-2">Dato</label><input id="pl-date" class="input" type="date" value="${planState.date}" /><label class="label mt-2">M√•l for tr√¶ningen (valgfrit)</label><textarea id="pl-goal" class="textarea" placeholder="Fx: Forbedre pasningsspil under pres">${planState.goal||''}</textarea><label class="label mt-2">Deltagende spillere</label>${ team && _teamPlayers.length>0?`<div class="flex-wrap" id="pl-player-checkboxes">${_teamPlayers.map(p=>`<label class="badge"><input type="checkbox" class="pl-player-checkbox" data-player-name="${p}" ${planState.participating_players.includes(p)?'checked':''} style="margin-right:4px;"/>${p}</label>`).join('')}</div>`:`<div class="text-sm text-muted">Ingen spillere p√• dette hold endnu.</div>` }<label class="label mt-2">Ekstra spillere (komma- eller linjeskift-separeret)</label><input id="pl-extra-players" class="input" placeholder="Fx g√¶stespillere" value="${planState.extra_players_text||''}" /><label class="label mt-2">Generelle noter</label><textarea id="pl-notes" class="textarea">${planState.notes||''}</textarea><div class="mt-3 flex-between"><div><div class="text-xs text-muted">Total varighed</div><div style="font-size:20px;font-weight:700;">${totalDuration} min</div></div><button class="btn btn-success" onclick="savePlannedSession()">Gem tr√¶ning</button></div></div><div class="card"><div class="card-header">√òvelser i tr√¶ningen</div><div class="mt-2" id="pl-ex-list"></div></div></div><div class="card mt-3"><div class="card-header">√òvelser (billedoversigt) <div style="margin-left:auto"><input id="pl-free-title" class="input" placeholder="Fritekst √∏velse, fx 'l√∏b i 10 min'" style="display:inline-block;width:65%;margin-right:8px;"/><input id="pl-free-duration" class="input" placeholder="min" style="width:70px;display:inline-block;margin-right:8px;"/><button class="btn btn-primary" onclick="addFreeExerciseToPlan()">Tilf√∏j spontan √∏velse</button></div></div><div id="pl-ex-gallery"></div></div>`;
    // wire up selects and inputs
    const teamSelect=document.getElementById('pl-team'); if(teamSelect){ teamSelect.value=planState.team_name; teamSelect.onchange=e=>{ planState.team_name=e.target.value; planState.participating_players=[]; renderPlan(); } }
    const dateInput=document.getElementById('pl-date'); if(dateInput) dateInput.onchange=e=>planState.date=e.target.value;
    const goalInput=document.getElementById('pl-goal'); if(goalInput) goalInput.oninput=e=>planState.goal=e.target.value;
    const notesInput=document.getElementById('pl-notes'); if(notesInput) notesInput.oninput=e=>planState.notes=e.target.value;
    const extraInput=document.getElementById('pl-extra-players'); if(extraInput) extraInput.oninput=e=>planState.extra_players_text=e.target.value;

    const playerCheckboxes=document.querySelectorAll('.pl-player-checkbox'); playerCheckboxes.forEach(cb=>{ cb.onchange=()=>{ const name=cb.getAttribute('data-player-name'); if(!name) return; const arr=planState.participating_players; const idx=arr.indexOf(name); if(cb.checked){ if(idx===-1) arr.push(name);} else { if(idx!==-1) arr.splice(idx,1);} redrawPlanExercises(); } });

    redrawPlanExercises(); renderPlanExerciseGallery(); }

  function addFreeExerciseToPlan(){ const title=document.getElementById('pl-free-title').value.trim(); const dur=parseInt(document.getElementById('pl-free-duration').value,10)||10; if(!title){ alert('Skriv titel for den spontane √∏velse.'); return; } planState.exerciseSelections.push({ exercise_number: 'FR-'+Date.now(), exercise_title: title, planned_duration_min: dur, notes: '', exercise_players: [] }); redrawPlanExercises(); saveData(); }

  function redrawPlanExercises(){ const container=document.getElementById('pl-ex-list'); if(!container) return; if(planState.exerciseSelections.length===0){ container.innerHTML = `<div class="text-sm text-muted">Ingen √∏velser tilf√∏jet endnu. Brug billedoversigten nedenfor.</div>`; return; } const participants = planState.participating_players||[]; container.innerHTML = planState.exerciseSelections.map((item,idx)=>{ const ex=findExerciseByNumber(item.exercise_number); const title = ex?ex.title:item.exercise_title||''; const dur=item.planned_duration_min||ex?.duration_min||0; const img = ex&&ex.media_url?ex.media_url:''; const isGroup = ex&&ex.requires_groups; const minGroupsText = isGroup&&ex.min_groups? ' ‚Äì min. '+ex.min_groups+' grupper':''; const selectedPlayers = item.exercise_players||[]; const gkInfo = typeof ex?.goalkeepers_required==='number'? ex.goalkeepers_required+' m√•lm.' : ''; const playersSection = isGroup?`<div class="mt-1"><div class="text-xs text-muted">Gruppe√∏velse${minGroupsText}</div>${ participants.length===0?`<div class="text-xs text-muted">V√¶lg deltagende spillere i venstre side for at tilknytte spillere til √∏velsen.</div>`:`<div class="flex-wrap mt-1">${participants.map(p=>`<label class="badge"><input type="checkbox" class="pl-ex-player-checkbox" data-ex-index="${idx}" data-player-name="${p}" ${selectedPlayers.includes(p)?'checked':''} style="margin-right:4px;"/>${p}</label>`).join('')}</div>`}</div>`:''; return `<div class="card" style="padding:8px; margin-bottom:6px;"><div class="flex">${ img?`<div style="width:80px;height:60px;margin-right:8px;border:1px solid var(--border);border-radius:6px;overflow:hidden;flex-shrink:0;"><img src="${img}" alt="${title}" style="width:100%;height:100%;object-fit:cover;cursor:pointer;" onclick="openImageModal('${img}')"/></div>`:'' }<div style="flex:1;"><div class="flex-between"><div><div><strong>${idx+1}.</strong> ${item.exercise_number?('#'+item.exercise_number+' '):''}${title||''}</div><div class="text-xs text-muted">${ex?.purpose||ex?.description||''}</div>${ gkInfo?`<div class="text-xs text-muted">Kr√¶ver ${gkInfo}</div>`:'' }${playersSection}</div><div style="text-align:right;"><div class="text-xs text-muted">Varighed</div><input type="number" min="1" value="${dur}" style="width:60px;" onchange="updatePlanExerciseDuration(${idx}, this.value)" /><div style="margin-top:6px;"><button class="btn btn-ghost btn-sm" onclick="removeExerciseFromPlan(${idx})">Fjern</button><button class="btn btn-ghost btn-sm plan-move-btn" onclick="movePlanUp(${idx})">‚ñ≤</button><button class="btn btn-ghost btn-sm plan-move-btn" onclick="movePlanDown(${idx})">‚ñº</button></div></div></div></div></div>`; }).join(''); const exPlayerCheckboxes=document.querySelectorAll('.pl-ex-player-checkbox'); exPlayerCheckboxes.forEach(cb=>{ cb.onchange=()=>{ const exIndex=parseInt(cb.getAttribute('data-ex-index'),10); const name=cb.getAttribute('data-player-name'); if(isNaN(exIndex)||!name) return; const item=planState.exerciseSelections[exIndex]; if(!item) return; if(!Array.isArray(item.exercise_players)) item.exercise_players=[]; const arr=item.exercise_players; const idx=arr.indexOf(name); if(cb.checked){ if(idx===-1) arr.push(name);} else { if(idx!==-1) arr.splice(idx,1); } saveData(); } }); saveData(); }

  function movePlanUp(i){ if(i<=0) return; const a=planState.exerciseSelections; [a[i-1],a[i]]=[a[i],a[i-1]]; redrawPlanExercises(); saveData(); }
  function movePlanDown(i){ const a=planState.exerciseSelections; if(i>=a.length-1) return; [a[i+1],a[i]]=[a[i],a[i+1]]; redrawPlanExercises(); saveData(); }

  function addExerciseNumberToPlan(num){ const ex=findExerciseByNumber(num); if(!ex) return; planState.exerciseSelections.push({ exercise_number: ex.number, exercise_title: ex.title, planned_duration_min: ex.duration_min||10, notes:'', exercise_players:[] }); redrawPlanExercises(); saveData(); }
  function removeExerciseFromPlan(index){ planState.exerciseSelections.splice(index,1); redrawPlanExercises(); saveData(); }
  function updatePlanExerciseDuration(index,value){ const v=parseInt(value,10)||0; if(!planState.exerciseSelections[index]) return; planState.exerciseSelections[index].planned_duration_min=v; renderPlan(); saveData(); }

  function renderPlanExerciseGallery(){ const container=document.getElementById('pl-ex-gallery'); if(!container) return; const exercises=data.exercises; if(exercises.length===0){ container.innerHTML=`<div class="text-sm text-muted">Ingen √∏velser oprettet endnu.</div>`; return; } container.innerHTML=`<div class="grid grid-3">${exercises.map(ex=>{ const img=ex.media_url; return `<div class="card" style="padding:8px;">${ img?`<div style="width:100%;height:120px;border-radius:8px;overflow:hidden;border:1px solid var(--border);margin-bottom:6px;"><img src="${img}" alt="${ex.title}" style="width:100%;height:100%;object-fit:cover;cursor:pointer;" onclick="openImageModal('${img}')"/></div>`:`<div style="width:100%;height:120px;border-radius:8px;border:1px dashed var(--border);display:flex;align-items:center;justify-content:center;font-size:11px;color:var(--gray);margin-bottom:6px;">Intet billede</div>` }<div class="text-xs text-muted">#${ex.number}</div><div style="font-weight:600;font-size:13px;">${ex.title}</div><div class="text-xs text-muted">${ex.purpose||ex.description||''}</div><div class="mt-2" style="display:flex;justify-content:space-between;align-items:center;"><span class="text-xs text-muted">${ex.duration_min||0} min</span><button class="btn btn-primary btn-sm" onclick="addExerciseNumberToPlan('${ex.number}')">Tilf√∏j</button></div></div>` }).join('')}</div>`; }

  // Image modal handlers
  function openImageModal(src){ const modal=document.getElementById('imageModal'); const content=document.getElementById('imageModalContent'); content.innerHTML=`<img src="${src}" alt="billede" style="max-width:100%;height:auto;display:block;margin:0 auto;"/>`; modal.classList.add('show'); }
  document.getElementById('closeImageModal').onclick = ()=>{ document.getElementById('imageModal').classList.remove('show'); };

  // Print function: include equipment list at top
  function printSession(id){ const session=data.sessions.find(s=>s.id===id); if(!session){ alert('Kunne ikke finde tr√¶ningen.'); return; } const items=session.items||[]; const dateText=fmtDate(session.date);
    // collect equipment
    const equipmentCount={}; items.forEach(it=>{ const ex=findExerciseByNumber(it*
ÓÄÄ
